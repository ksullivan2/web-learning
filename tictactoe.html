<html>
<style type = "text/css">
	button.square{
		font-size: 20px; 
		vertical-align: text-top;
	}

</style>


<body><script type="text/javascript">
//"use strict";

//model
function Game(){
	//create view
	drawBoard(this);

	//set game properties
	this.xTurn = true;
	this.board = new BoardModel(this);
	this.winner = "test"
}

Game.prototype.checkForWin = function(){
	if (this.board.checkRows() || this.board.checkCols() || this.board.checkDiagonals()){
		console.log(this.winner)
	}
}

function BoardModel(game){
	this.game = game

	this.grid = []
	//simutaneously create data structure and html elements
	for (row = 0; row < 3; row ++){
		this.grid[row] = [];
		for (col = 0; col < 3; col ++){
			
			//add squares to grid and div, with references to html elements
			var id = row + "," + col;
			this.grid[row][col] = {value: "_", "square": document.getElementById(id)};
			
		}
	}

}

//controller
Game.prototype.buttonClickHandler = function(event){
	//check whose turn it was
	/*if (this.game.xTurn){
		var playerToken = "X"	
	}
	else {
		var playerToken = "O"	
	}
	
	//update view
	var makeAMark = document.createTextNode(playerToken)	
	event.target.appendChild(makeAMark)
	event.target.disabled = "true";

	//update controller
	var row = event.target.id[0]
	var col = event.target.id[2]
	this.game.board.grid[row][col].value = playerToken

	//swap whose turn it is
	this.game.xTurn = !this.game.xTurn

	//finish this check later
	this.game.checkForWin();*/

	this.game.board.disableAllSquares();
}


//view
function Square(game){
	var square = document.createElement("BUTTON");
	square.setAttribute("class","square")
	square.addEventListener("click", game.buttonClickHandler, false);

	//store reference to game object so it can pass events 
	square.game = game

	//these don't work as expected in the CSS... look into that
	square.style.height = "50px";
	square.style.width = "50px";

	return square
}


function drawBoard(game){
	for (row = 0; row < 3; row ++){
		//create a Div for that row
		var tempDiv = document.createElement("DIV");
		document.body.appendChild(tempDiv);

		for (col = 0; col < 3; col ++){
			//create and label squares
			tempSquare = new Square(game);
			var id = row + "," + col;
		 	tempSquare.id = id;
		 	tempDiv.appendChild(tempSquare);
		}
	}
}



BoardModel.prototype.disableAllSquares = function(){
	//disable click input on unused squares, keeps Xs and Os
	eachSquare(this.grid, function(square){
		square.disabled = true})

}

function resetAllSquares(grid){
	
}


			
//helper functions for model

function eachSquare(grid, action){
	for (row = 0; row < 3; row ++){
		for (col = 0; col < 3; col ++){
			action(grid[row][col].square);
		}
	}
}

function allInArrayEqual(array){
	if (array.length < 3){
		return false;
	}

	for (i = 0; i < array.length; i ++){
		if (array[i] == "_" || array[i] != array[0]){
			return false;
		}
	}
	return true;
}

BoardModel.prototype.checkRows = function(){
	for (row = 0; row < 3; row ++){
		var testArray = []

		for (col = 0; col < 3; col ++){
			testArray.push(this.grid[row][col].value);
			}
		if (allInArrayEqual(testArray)){
			this.game.winner = testArray[0]
			return true;
		}
	}
	return false;
}		


BoardModel.prototype.checkCols = function(){

	for (col = 0; col < 3; col ++){
		var testArray = []

		for (row = 0; row < 3; row ++){
			testArray.push(this.grid[row][col].value);
			}
		if (allInArrayEqual(testArray)){
			this.game.winner = testArray[0]
			return true;
		}
	}
	return false;
}

BoardModel.prototype.checkDiagonals = function(){
	var leftDiagonal = [this.grid[0][0].value,this.grid[1][1].value,this.grid[2][2].value]
	var rightDiagonal = [this.grid[0][2].value,this.grid[1][1].value,this.grid[2][0].value]
	if (allInArrayEqual(leftDiagonal)){
		this.game.winner = leftDiagonal[0];
		return true
	}
	else if (allInArrayEqual(rightDiagonal)){
		this.game.winner = rightDiagonal[0]
		return true
	};
	return false;
}

//runner function
game = new Game()





</script>




</script> </body> </html>
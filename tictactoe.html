<html>
<style type = "text/css">
	button.square{
		font-size: 20px; 
		vertical-align: text-top;
	}

</style>


<body><script type="text/javascript">
"use strict";



//MODEL
function BoardModel(){
	//set game properties
	this.xTurn = true;
	this.winner = "test";

	//create grid
	this.grid = [];
	for (var row = 0; row < 3; row ++){
		this.grid[row] = [];
		for (var col = 0; col < 3; col ++){
			
			//add blank data to grid
			this.grid[row][col] = "_"
		}
	}
}

BoardModel.prototype.resetBoardModel = function(){
	//clears board model, does not affect view
	this.grid.forEach(function(row){
		row.forEach(function(box){
		box = "_";
		})
	})
}


BoardModel.prototype.checkRows = function(){
	this.grid.forEach(function(row){
		var testArray = [];
		row.forEach(function(square){
			testArray.push(square);
		})
		if (allInArrayEqual(testArray)){
			this.winner = testArray[0];
			return true;
		}
	})
	return false;
}		


BoardModel.prototype.checkCols = function(){
	//looping through columns, against the grain of data structure, so easier to do for loop

	for (var col = 0; col < 3; col ++){
		var testArray = [];
		for (var row = 0; row < 3; row ++){
			testArray.push(this.grid[row][col]);
			}
		if (allInArrayEqual(testArray)){
			this.winner = testArray[0];
			return true;
		}
	}
	return false;
}

BoardModel.prototype.checkDiagonals = function(){
	var leftDiagonal = [this.grid[0][0],this.grid[1][1],this.grid[2][2]];
	var rightDiagonal = [this.grid[0][2],this.grid[1][1],this.grid[2][0]];
	
	if (allInArrayEqual(leftDiagonal)){
		this.winner = leftDiagonal[0];
		return true;
	}
	else if (allInArrayEqual(rightDiagonal)){
		this.winner = rightDiagonal[0];
		return true;
	};
	return false;
}





//VIEW

function Square(buttonClickHandler){
	var square = document.createElement("BUTTON");
	square.setAttribute("class","square");
	square.addEventListener("click", buttonClickHandler, false);

	var squareContent = document.createTextNode("");	
	square.appendChild(squareContent);

	//these don't work as expected in the CSS... look into that
	square.style.height = "50px";
	square.style.width = "50px";

	return square;
}


function drawBoard(buttonClickHandler){
	//not actually looping through an object here, just want the ranges
	for (var row = 0; row < 3; row ++){
		//create a Div for that row
		var tempDiv = document.createElement("DIV");
		document.body.appendChild(tempDiv);

		for (var col = 0; col < 3; col ++){
			//create and label squares
			var tempSquare = new Square(buttonClickHandler);
			var id = row + "," + col;
		 	tempSquare.id = id;
		 	tempDiv.appendChild(tempSquare);
		}
	}
}


function drawNewGameButton(newGameClickHandler){
	//create new div
	var newDiv = document.createElement("DIV");
	
	
	//create button
	var newGameButton = document.createElement("BUTTON");
	newGameButton.className = "newGame";
	newGameButton.id = "newGameButton";
	newGameButton.addEventListener("click", newGameClickHandler, false);

	//create text node
	var newGameText = document.createTextNode("New Game");
	newGameText.id = "newGameText";

	
	//put 'em all on screen
	document.body.appendChild(newDiv);
	newDiv.appendChild(newGameButton);
	newGameButton.appendChild(newGameText);
}

function updateViewSquare(pressedSquare, playerToken){
	//update view with current player's token

	//make squares start with these, just update text
	pressedSquare.firstChild.nodeValue = playerToken
	pressedSquare.disabled = "true";
}





//CONTROLLER

function Controller(){}	


Controller.prototype.checkForWin = function(){
	if (this.board.checkRows() || this.board.checkCols() || this.board.checkDiagonals()){
		this.disableAllSquares();
		//want to change this to create a win event or something, don't like that the model bypasses the controller
	}
}

Controller.prototype.updateModelSquare = function(pressedSquare, playerToken){
	//update model
	var row = pressedSquare.id[0];
	var col = pressedSquare.id[2];
	this.board.grid[row][col] = playerToken;
}

Controller.prototype.buttonClickHandler = function(event){
	//check whose turn it was
	if (this.board.xTurn){
		var playerToken = "X";	
	}
	else {
		var playerToken = "O";	
	}
	
	//update both model and view
	updateViewSquare(event.target, playerToken);
	this.updateModelSquare(event.target, playerToken);
	

	//check if the controller has been won
	this.checkForWin();

	//swap whose turn it is
	this.board.xTurn = !this.board.xTurn;
}

Controller.prototype.newGameClickHandler = function(event){
	//update both model and controller
	this.resetView();
	this.board.resetBoardModel();

}

Controller.prototype.resetView = function(){
	//re-enable buttons and clear Xs and Os
	var squares = document.getElementsByClassName("square");
	//returns a node list, must be iterated through, can't use forEach =(

	for (var i = 0; i < squares.length; i++){
		squares[i].disabled = false;
		squares[i].firstChild.nodeValue = "";
	}
}

Controller.prototype.disableAllSquares = function(){
	//disable click input on unused squares, keeps Xs and Os
	var squares = document.getElementsByClassName("square");
	//returns a node list, must be iterated through, can't use forEach =(

	for (var i = 0; i < squares.length; i++){
		squares[i].disabled = true;
	}
}




			
//helper functions for model

function allInArrayEqual(array){
	for (var i = 0; i < array.length; i ++){
		if (array[i] === "_" || array[i] !== array[0]){
			return false;
		}
	}
	return true;
}



function runner(){
	//create controller object
	var controller = new Controller();
	
	//create view
	drawBoard(controller.buttonClickHandler.bind(controller));
	drawNewGameButton(controller.newGameClickHandler.bind(controller));

	//the controller board contains a reference to the objects on screen, so must be called after the view is created
	controller.board = new BoardModel();
}

runner()


</script> </body> </html>